rangers = [
    {
        name: "Jason Lee Scott (Mighty Morphin Red)",
        color: "red",
        team: "mmpr",
        era: "saban"
    },
    {
        name: "Rocky DeSantos (Mighty Morphin Red)",
        color: "red",
        team: "mmpr",
        era: "saban"
    },
    {
        name: "Zack Taylor",
        color: "black",
        team: "mmpr",
        era: "saban"
    },
    {
        name: "Adam Park (Mighty Morphin Black)",
        color: "black",
        team: "mmpr",
        era: "saban"
    },
    {
        name: "Billy Cranston",
        color: "blue",
        team: "mmpr",
        era: "saban"
    },
    {
        name: "Trini Kwan",
        color: "yellow",
        team: "mmpr",
        era: "saban"
    },
    {
        name: "Aisha Campbell",
        color: "yellow",
        team: "mmpr",
        era: "saban"
    },
    {
        name: "Kimberly Ann Hart",
        color: "pink",
        team: "mmpr",
        era: "saban"
    },
    {
        name: "Katherine Hillard (Mighty Morphin Pink)",
        color: "pink",
        team: "mmpr",
        era: "saban"
    },
    {
        name: "Tommy Oliver (Mighty Morphin Green)",
        color: "green",
        team: "mmpr",
        era: "saban"
    },
    {
        name: "Tommy Oliver (Mighty Morphin White)",
        color: "white",
        team: "mmpr",
        era: "saban"
    },
    {
        name: "Aurico",
        color: "red",
        team: "alien",
        era: "saban"
    },
    {
        name: "Delphine",
        color: "white",
        team: "alien",
        era: "saban"
    },
    {
        name: "Cestro",
        color: "blue",
        team: "alien",
        era: "saban"
    },
    {
        name: "Tideus",
        color: "yellow",
        team: "alien",
        era: "saban"
    },
    {
        name: "Corcus",
        color: "black",
        team: "alien",
        era: "saban"
    },
    {
        name: "Tommy Oliver (Zeo Red)",
        color: "red",
        team: "zeo",
        era: "saban"
    },
    {
        name: "Adam Park (Zeo Green)",
        color: "green",
        team: "zeo",
        era: "saban"
    },
    {
        name: "Rocky DeSantos (Zeo Blue)",
        color: "blue",
        team: "zeo",
        era: "saban"
    },
    {
        name: "Tanya Sloan (Zeo Yellow)",
        color: "yellow",
        team: "zeo",
        era: "saban"
    },
    {
        name: "Katherine Hillard (Zeo Pink)",
        color: "pink",
        team: "zeo",
        era: "saban"
    },
    {
        name: "Trey of Triforia",
        color: "gold",
        team: "zeo",
        era: "saban"
    },
    {
        name: "Jason Lee Scott (Zeo Gold)",
        color: "gold",
        team: "zeo",
        era: "saban"
    },
    {
        name: "Tommy Oliver (Turbo Red)",
        color: "red",
        team: "turbo",
        era: "saban"
    },
    {
        name: "T.J. Johnson (Turbo Red)",
        color: "red",
        team: "turbo",
        era: "saban"
    },
    {
        name: "Justin Stewart",
        color: "blue",
        team: "turbo",
        era: "saban"
    },
    {
        name: "Adam Park (Turbo Green)",
        color: "green",
        team: "turbo",
        era: "saban"
    },
    {
        name: "Carlos Vallerte (Turbo Green)",
        color: "green",
        team: "turbo",
        era: "saban"
    },
    {
        name: "Tanya Sloan (Turbo Yellow)",
        color: "yellow",
        team: "turbo",
        era: "saban"
    },
    {
        name: "Ashley Hammond (Turbo Yellow)",
        color: "yellow",
        team: "turbo",
        era: "saban"
    },
    {
        name: "Katherine Hillard (Turbo Pink)",
        color: "pink",
        team: "turbo",
        era: "saban"
    },
    {
        name: "Cassie Chan (Turbo Pink)",
        color: "pink",
        team: "turbo",
        era: "saban"
    },
    {
        name: "Phantom Ranger (Black)",
        color: "black",
        team: "turbo",
        era: "saban"
    },
    {
        name: "Andros",
        color: "red",
        team: "inspace",
        era: "saban"
    },
    {
        name: "Carlos Vallerte (In Space Black)",
        color: "black",
        team: "inspace",
        era: "saban"
    },
    {
        name: "T.J. Johnson (In Space Blue)",
        color: "blue",
        team: "inspace",
        era: "saban"
    },
    {
        name: "Ashley Hammond (In Space Yellow)",
        color: "yellow",
        team: "inspace",
        era: "saban"
    },
    {
        name: "Cassie Chan (In Space Pink)",
        color: "pink",
        team: "inspace",
        era: "saban"
    },
    {
        name: "Zhane",
        color: "silver",
        team: "inspace",
        era: "saban"
    },
    {
        name: "Leo Corbett",
        color: "red",
        team: "lostgalaxy",
        era: "saban"
    },
    {
        name: "Kai Chen",
        color: "blue",
        team: "lostgalaxy",
        era: "saban"
    },
    {
        name: "Damon Henderson",
        color: "green",
        team: "lostgalaxy",
        era: "saban"
    },
    {
        name: "Maya",
        color: "yellow",
        team: "lostgalaxy",
        era: "saban"
    },
    {
        name: "Kendrix Morgan",
        color: "pink",
        team: "lostgalaxy",
        era: "saban"
    },
    {
        name: "Karone",
        color: "pink",
        team: "lostgalaxy",
        era: "saban"
    },
    {
        name: "Carter Grayson",
        color: "red",
        team: "lightspeed",
        era: "saban"
    },
    {
        name: "Chad Lee",
        color: "blue",
        team: "lightspeed",
        era: "saban"
    },
    {
        name: "Joel Rawlings",
        color: "green",
        team: "lightspeed",
        era: "saban"
    },
    {
        name: "Kelsey Windslow",
        color: "yellow",
        team: "lightspeed",
        era: "saban"
    },
    {
        name: "Dana Mitchell",
        color: "pink",
        team: "lightspeed",
        era: "saban"
    },
    {
        name: "Ryan Mitchell (Silver)",
        color: "silver",
        team: "lightspeed",
        era: "saban"
    },
    {
        name: "Alex Drake",
        color: "red",
        team: "timeforce",
        era: "saban"
    },
    {
        name: "Wesley Collins",
        color: "red",
        team: "timeforce",
        era: "saban"
    },
    {
        name: "Eric Myers",
        color: "red",
        team: "timeforce",
        era: "saban"
    },
    {
        name: "Jen Scotts",
        color: "pink",
        team: "timeforce",
        era: "saban"
    },
    {
        name: "Lucas Kendall",
        color: "blue",
        team: "timeforce",
        era: "saban"
    },
    {
        name: "Katie Walker",
        color: "yellow",
        team: "timeforce",
        era: "saban"
    },
    {
        name: "Trip",
        color: "green",
        team: "timeforce",
        era: "saban"
    },
    {
        name: "Cole Evans",
        color: "red",
        team: "wildforce",
        era: "disney"
    },
    {
        name: "Taylor Earhardt",
        color: "yellow",
        team: "wildforce",
        era: "disney"
    },
    {
        name: "Max Cooper",
        color: "blue",
        team: "wildforce",
        era: "disney"
    },
    {
        name: "Danny Delgado",
        color: "black",
        team: "wildforce",
        era: "disney"
    },
    {
        name: "Alyssa Enril√©",
        color: "white",
        team: "wildforce",
        era: "disney"
    },
    {
        name: "Merrick Baliton",
        color: "silver",
        team: "wildforce",
        era: "disney"
    },
    {
        name: "Shane Clarke",
        color: "red",
        team: "ninjastorm",
        era: "disney"
    },
    {
        name: "Hunter Bradley",
        color: "red",
        team: "ninjastorm",
        era: "disney"
    },
    {
        name: "Tori Hanson",
        color: "blue",
        team: "ninjastorm",
        era: "disney"
    },
    {
        name: "Blake Bradley",
        color: "blue",
        team: "ninjastorm",
        era: "disney"
    },
    {
        name: "Dustin Brooks",
        color: "yellow",
        team: "ninjastorm",
        era: "disney"
    },
    {
        name: "Cameron Watanabe",
        color: "green",
        team: "ninjastorm",
        era: "disney"
    },
    {
        name: "Conner McKnight",
        color: "red",
        team: "dinothunder",
        era: "disney"
    },
    {
        name: "Ethan James",
        color: "blue",
        team: "dinothunder",
        era: "disney"
    },
    {
        name: "Kira Ford",
        color: "yellow",
        team: "dinothunder",
        era: "disney"
    },
    {
        name: "Tommy Oliver (Dino Thunder Black)",
        color: "black",
        team: "dinothunder",
        era: "disney"
    },
    {
        name: "Trent Fernandez-Mercer",
        color: "white",
        team: "dinothunder",
        era: "disney"
    },
    {
        name: "Jack Landors",
        color: "red",
        team: "spd",
        era: "disney"
    },
    {
        name: "Sky Tate (SPD Red)",
        color: "red",
        team: "spd",
        era: "disney"
    },
    {
        name: "Bridge Carson (SPD Red)",
        color: "red",
        team: "spd",
        era: "disney"
    },
    {
        name: "Sky Tate (SPD Blue)",
        color: "blue",
        team: "spd",
        era: "disney"
    },
    {
        name: "Bridge Carson (SPD Blue)",
        color: "blue",
        team: "spd",
        era: "disney"
    },
    {
        name: "Bridge Carson (SPD Green)",
        color: "green",
        team: "spd",
        era: "disney"
    },
    {
        name: "Z Delgado",
        color: "yellow",
        team: "spd",
        era: "disney"
    },
    {
        name: "Syd Drew",
        color: "pink",
        team: "spd",
        era: "disney"
    },
    {
        name: "Anubis Cruger (Black)",
        color: "black",
        team: "spd",
        era: "disney"
    },
    {
        name: "Sam (White)",
        color: "white",
        team: "spd",
        era: "disney"
    },
    {
        name: "Kat Manx (White)",
        color: "white",
        team: "spd",
        era: "disney"
    },
    {
        name: "Nova (Silver)",
        color: "silver",
        team: "spd",
        era: "disney"
    },
    {
        name: "Nick Russell",
        color: "red",
        team: "mysticforce",
        era: "disney"
    },
    {
        name: "Chip Thorn",
        color: "yellow",
        team: "mysticforce",
        era: "disney"
    },
    {
        name: "Madison Rocca",
        color: "blue",
        team: "mysticforce",
        era: "disney"
    },
    {
        name: "Vida Rocca",
        color: "pink",
        team: "mysticforce",
        era: "disney"
    },
    {
        name: "Xander Bly",
        color: "green",
        team: "mysticforce",
        era: "disney"
    },
    {
        name: "Udonna",
        color: "white",
        team: "mysticforce",
        era: "disney"
    },
    {
        name: "Daggeron",
        color: "gold",
        team: "mysticforce",
        era: "disney"
    },
    {
        name: "Leanbow",
        color: "red",
        team: "mysticforce",
        era: "disney"
    },
    {
        name: "Mack Hartford",
        color: "red",
        team: "operationoverdrive",
        era: "disney"
    },
    {
        name: "Will Aston",
        color: "black",
        team: "operationoverdrive",
        era: "disney"
    },
    {
        name: "Dax Lo",
        color: "blue",
        team: "operationoverdrive",
        era: "disney"
    },
    {
        name: "Ronny Robinson",
        color: "yellow",
        team: "operationoverdrive",
        era: "disney"
    },
    {
        name: "Rose Ortiz",
        color: "pink",
        team: "operationoverdrive",
        era: "disney"
    },
    {
        name: "Tyzonn",
        color: "silver",
        team: "operationoverdrive",
        era: "disney"
    },
    {
        name: "Casey Rhodes",
        color: "red",
        team: "junglefury",
        era: "disney"
    },
    {
        name: "Lily Chilman",
        color: "yellow",
        team: "junglefury",
        era: "disney"
    },
    {
        name: "Theo Martin",
        color: "blue",
        team: "junglefury",
        era: "disney"
    },
    {
        name: "RJ",
        color: "purple",
        team: "junglefury",
        era: "disney"
    },
    {
        name: "Dominic Hargan",
        color: "white",
        team: "junglefury",
        era: "disney"
    },
    {
        name: "Elephant Spirit Ranger",
        color: "green",
        team: "junglefury",
        era: "disney"
    },
    {
        name: "Bat Spirit Ranger",
        color: "black",
        team: "junglefury",
        era: "disney"
    },
    {
        name: "Shark Spirit Ranger",
        color: "blue",
        team: "junglefury",
        era: "disney"
    },
    {
        name: "Scott Truman",
        color: "red",
        team: "rpm",
        era: "disney"
    },
    {
        name: "Flynn McAllistair",
        color: "blue",
        team: "rpm",
        era: "disney"
    },
    {
        name: "Summer Landsdown",
        color: "yellow",
        team: "rpm",
        era: "disney"
    },
    {
        name: "Ziggy Grover",
        color: "green",
        team: "rpm",
        era: "disney"
    },
    {
        name: "Dillon",
        color: "black",
        team: "rpm",
        era: "disney"
    },
    {
        name: "Gem",
        color: "gold",
        team: "rpm",
        era: "disney"
    },
    {
        name: "Gemma",
        color: "silver",
        team: "rpm",
        era: "disney"
    },
    {
        name: "Jayden Shiba",
        color: "red",
        team: "samurai",
        era: "neo-saban"
    },
    {
        name: "Lauren Shiba",
        color: "red",
        team: "samurai",
        era: "neo-saban"
    },
    {
        name: "Kevin",
        color: "blue",
        team: "samurai",
        era: "neo-saban"
    },
    {
        name: "Mia Watanabe",
        color: "pink",
        team: "samurai",
        era: "neo-saban"
    },
    {
        name: "Mike",
        color: "green",
        team: "samurai",
        era: "neo-saban"
    },
    {
        name: "Emily",
        color: "yellow",
        team: "samurai",
        era: "neo-saban"
    },
    {
        name: "Antonio Garcia",
        color: "gold",
        team: "samurai",
        era: "neo-saban"
    },
    {
        name: "Troy Burrows",
        color: "red",
        team: "megaforce",
        era: "neo-saban"
    },
    {
        name: "Noah Carver",
        color: "blue",
        team: "megaforce",
        era: "neo-saban"
    },
    {
        name: "Gia Moran",
        color: "yellow",
        team: "megaforce",
        era: "neo-saban"
    },
    {
        name: "Jake Holling (Megaforce Black)",
        color: "black",
        team: "megaforce",
        era: "neo-saban"
    },
    {
        name: "Jake Holling (Super Megaforce Green)",
        color: "green",
        team: "megaforce",
        era: "neo-saban"
    },
    {
        name: "Emma Goodall",
        color: "pink",
        team: "megaforce",
        era: "neo-saban"
    },
    {
        name: "Robo Knight (Silver)",
        color: "silver",
        team: "megaforce",
        era: "neo-saban"
    },
    {
        name: "Orion",
        color: "silver",
        team: "megaforce",
        era: "neo-saban"
    },
    {
        name: "Tyler Navarro",
        color: "red",
        team: "dinocharge",
        era: "neo-saban"
    },
    {
        name: "Chase Randall",
        color: "black",
        team: "dinocharge",
        era: "neo-saban"
    },
    {
        name: "Koda",
        color: "blue",
        team: "dinocharge",
        era: "neo-saban"
    },
    {
        name: "Riley Griffin",
        color: "green",
        team: "dinocharge",
        era: "neo-saban"
    },
    {
        name: "Shelby Watkins",
        color: "pink",
        team: "dinocharge",
        era: "neo-saban"
    },
    {
        name: "Sir Ivan of Zandar",
        color: "gold",
        team: "dinocharge",
        era: "neo-saban"
    },
    {
        name: "James Navarro",
        color: "blue",
        team: "dinocharge",
        era: "neo-saban"
    },
    {
        name: "Prince Phillip III",
        color: "silver",
        team: "dinocharge",
        era: "neo-saban"
    },
    {
        name: "Albert Smith",
        color: "purple",
        team: "dinocharge",
        era: "neo-saban"
    },
    {
        name: "Kendall Morgan",
        color: "purple",
        team: "dinocharge",
        era: "neo-saban"
    },
    {
        name: "Zenowing",
        color: "silver",
        team: "dinocharge",
        era: "neo-saban"
    },
    {
        name: "Dane Romero",
        color: "red",
        team: "ninjasteel",
        era: "neo-saban"
    },
    {
        name: "Brody Romero",
        color: "red",
        team: "ninjasteel",
        era: "neo-saban"
    },
    {
        name: "Mick Kanic",
        color: "red",
        team: "ninjasteel",
        era: "neo-saban"
    },
    {
        name: "Preston Tien",
        color: "blue",
        team: "ninjasteel",
        era: "neo-saban"
    },
    {
        name: "Calvin Maxwell",
        color: "yellow",
        team: "ninjasteel",
        era: "neo-saban"
    },
    {
        name: "Hayley Foster",
        color: "white",
        team: "ninjasteel",
        era: "neo-saban"
    },
    {
        name: "Sarah Thompson",
        color: "pink",
        team: "ninjasteel",
        era: "neo-saban"
    },
    {
        name: "Levi Weston",
        color: "gold",
        team: "ninjasteel",
        era: "neo-saban"
    },
    {
        name: "Devon Daniels",
        color: "red",
        team: "beastmorphers",
        era: "hasbro"
    },
    {
        name: "Ravi Shaw",
        color: "blue",
        team: "beastmorphers",
        era: "hasbro"
    },
    {
        name: "Zoey Reeves",
        color: "yellow",
        team: "beastmorphers",
        era: "hasbro"
    },
    {
        name: "Nate Silva",
        color: "gold",
        team: "beastmorphers",
        era: "hasbro"
    },
    {
        name: "Steel",
        color: "silver",
        team: "beastmorphers",
        era: "hasbro"
    },
    {
        name: "Zayto",
        color: "red",
        team: "dinofury",
        era: "hasbro"
    },
    {
        name: "Ollie Akana",
        color: "blue",
        team: "dinofury",
        era: "hasbro"
    },
    {
        name: "Amelia Jones",
        color: "pink",
        team: "dinofury",
        era: "hasbro"
    },
    {
        name: "Izzy Garcia",
        color: "green",
        team: "dinofury",
        era: "hasbro"
    },
    {
        name: "Javi Garcia",
        color: "black",
        team: "dinofury",
        era: "hasbro"
    },
    {
        name: "Aiyon",
        color: "gold",
        team: "dinofury",
        era: "hasbro"
    }
]

const rootElem = document.querySelector(":root");

//Header buttons
const instructionsButton = document.querySelector("#toggle-instructions");
const statisticsButton = document.querySelector("#toggle-statistics");
const settingsButton = document.querySelector("#toggle-settings");

//Modal elements
const closeButton = document.querySelector(".close-modal");
const modalElem = document.querySelector(".modal");
const backdropElem = document.querySelector(".backdrop");
const instructionsElem = document.querySelector(".instructions");
const statisticsElem = document.querySelector(".statistics");
const settingsElem = document.querySelector(".settings");

//Statistics modal elements
const gamesPlayedElem = document.querySelector("#games-played");
const winrateElem = document.querySelector("#winrate");
const currentStreakElem = document.querySelector("#current-streak");
const bestStreakElem = document.querySelector("#best-streak");
const barElems = document.querySelector(".chart").children;

//Settings modal elements
const themeToggle = document.querySelector("#theme-toggle");

//Guessing elements
const guessesElems = document.querySelector(".guesses").children;
const formElem = document.querySelector("#form");
const inputElem = document.querySelector("#input");

//Feedback elements
const targetElem = document.querySelector(".target-ranger");
const feedbackElem = document.querySelector(".feedback");
const timeElem = document.querySelector(".time");
const shareButton = document.querySelector("#share");

setDarkTheme(localStorage.getItem("darkTheme") === "true");

let target = rangers[hashDate(new Date())];
let guesses = [];

let gameState = "incomplete";
let gameData = JSON.parse(localStorage.getItem("gameData")) || [];
let guessesAsEmoji = "";


//Display saved data for today's guesses
for (let i = 0; i < gameData.length; i++) {
    if (gameData[i].date === (new Date).toISOString().slice(0, 10)) {
        gameData[i].guesses.forEach(guess => {
            handleGuess(guessesElems[guesses.length], guess);
        });
        break;
    }
}

//Allow guessing if no attempts made today
if (guesses.length == 0) {
    startGuessing();
}
displayGuessDistribution();

//Show only instructions modal
instructionsButton.addEventListener("click", () => {
    showModal();
    statisticsElem.classList.add("hidden");
    instructionsElem.classList.remove("hidden");
    settingsElem.classList.add("hidden");
})

//Show only statistics modal
statisticsButton.addEventListener("click", () => {
    showModal();
    statisticsElem.classList.remove("hidden");
    instructionsElem.classList.add("hidden");
    settingsElem.classList.add("hidden");
})

//Show only settings modal
settingsButton.addEventListener("click", () => {
    showModal();
    statisticsElem.classList.add("hidden");
    instructionsElem.classList.add("hidden");
    settingsElem.classList.remove("hidden");
})

closeButton.addEventListener("click", () => {
    closeModal();
})

backdropElem.addEventListener("click", () => {
    closeModal();
})

function showModal() {
    modalElem.classList.remove("modal-hidden");
    backdropElem.classList.remove("hidden");
}

function closeModal() {
    backdropElem.classList.add("hidden");
    modalElem.classList.add("modal-hidden");
}

themeToggle.addEventListener('change', () => {
    setDarkTheme(themeToggle.checked);
    localStorage.setItem("darkTheme", themeToggle.checked);
});

function setDarkTheme(bool) {
    if (bool) {
        //Switch to dark mode
        rootElem.style.setProperty('--bg-color', getComputedStyle(rootElem).getPropertyValue('--bg-dark'));
        rootElem.style.setProperty('--header-bg-color', getComputedStyle(rootElem).getPropertyValue('--header-bg-dark'));
        rootElem.style.setProperty('--text-color', getComputedStyle(rootElem).getPropertyValue('--text-dark'));
        rootElem.style.setProperty('--guess-bg-color', getComputedStyle(rootElem).getPropertyValue('--guess-bg-dark'));
    }
    else {
        //Switch to light mode
        rootElem.style.setProperty('--bg-color', getComputedStyle(rootElem).getPropertyValue('--bg-light'));
        rootElem.style.setProperty('--header-bg-color', getComputedStyle(rootElem).getPropertyValue('--header-bg-light'));
        rootElem.style.setProperty('--text-color', getComputedStyle(rootElem).getPropertyValue('--text-light'));
        rootElem.style.setProperty('--guess-bg-color', getComputedStyle(rootElem).getPropertyValue('--guess-bg-light'));
    }
    themeToggle.checked = bool;
}

//Process guess if ranger exists
formElem.addEventListener("submit", (event) => {
    event.preventDefault();
    let ranger = getRanger(inputElem.value);
    if (ranger) {
        handleGuess(guessesElems[guesses.length], ranger);
    }
    inputElem.value = "";
})

//Create share text using guessesAsEmoji and copy to clipboard
shareButton.addEventListener("click", () => {
    let shareText = `Mighty Morphle ${new Date().toISOString().slice(0, 10)} ${gameState === "loss" ? "X" : guesses.length}/8 \n`;
    //Insert \n after every 4 emojis 
    const emojis = guessesAsEmoji.split(" ");
    for (let i = 0; i < emojis.length; i++) {
        if ((i + 1) % 4 == 0) {
            shareText += emojis[i] + "\n";
        }
        else {
            shareText += emojis[i];
        }
    }
    shareText += "ib-rim.github.io/power-ranger-wordle";
    navigator.clipboard.writeText(shareText);
})

//Get ranger object from list using name
function getRanger(rangerName) {
    for (let i = 0; i < rangers.length; i++) {
        if (rangers[i].name === rangerName) {
            return rangers[i];
        }
    }
    return "";
}

//Create hash using given date
function hashDate(d) {
    let dateString = d.toDateString().slice(4);
    let sum = 0;
    for (let i = 0; i < dateString.length; i++) {
        sum += dateString.charCodeAt(i);
        sum *= 10;
        sum -= 53;
    }
    sum *= getDayOfYear(d);
    let dateHashed = sum % rangers.length;
    return dateHashed;
}

//Calculate day of the year 1-365 (366 if leap year)
function getDayOfYear(date = new Date()) {
    const timestamp1 = Date.UTC(
        date.getFullYear(),
        date.getMonth(),
        date.getDate(),
    );
    const timestamp2 = Date.UTC(date.getFullYear(), 0, 0);

    const differenceInMilliseconds = timestamp1 - timestamp2;

    const differenceInDays = differenceInMilliseconds / 1000 / 60 / 60 / 24;

    return differenceInDays;
}

//Save game data to local storage
function saveGameData() {
    let todaySaved = false;

    //Override today's data with any new data
    for (let i = 0; i < gameData.length && !todaySaved; i++) {
        if (gameData[i].date === (new Date).toISOString().slice(0, 10)) {
            gameData[i] = {
                "date": (new Date).toISOString().slice(0, 10),
                "guesses": guesses,
                "state": gameState,
            };
            todaySaved = true;
        }
    }

    //Save today's data to localStorage if not already saved
    if (!todaySaved) {
        gameData.push({
            "date": (new Date).toISOString().slice(0, 10),
            "guesses": guesses,
            "state": gameState,
        })
    }
    localStorage.setItem("gameData", JSON.stringify(gameData));

    calculateStatistics();
    displayGuessDistribution();
}

//Calculate statistics for statistics modal
function calculateStatistics() {
    gamesPlayedElem.textContent = calculateGamesPlayed();
    winrateElem.textContent = `${calculateWinPercentage()}%`;
    currentStreakElem.textContent = calculateCurrentStreak();
    bestStreakElem.textContent = calculateBestStreak();
}

//Calculate games played (only complete games: wins and losses)
function calculateGamesPlayed() {
    let gamesPlayed = 0;
    gameData.forEach(game => {
        if ((game.state !== "incomplete")) {
            gamesPlayed++;
        }
    });
    return gamesPlayed;
}

//Calculate win percentage
function calculateWinPercentage() {
    let winCount = 0;
    gameData.forEach(game => {
        if (game.state === "win") {
            winCount++;
        }
    });
    return Math.round(winCount / calculateGamesPlayed() * 100) || 0;
}

//Calculate current streak
function calculateCurrentStreak() {
    let currentStreak = 0;
    for (let i = gameData.length - 1; i >= 0; i--) {
        if (gameData[i].state !== "incomplete") {
            if (gameData[i].state === "win") {
                currentStreak++;
            }
            else {
                break;
            }
        }
    }
    return currentStreak;
}

//Calculate best streak 
function calculateBestStreak() {
    let bestStreak = 0;
    let streak = 0;
    for (let i = 0; i < gameData.length; i++) {
        if (gameData[i].state === "win") {
            streak++;
            if (streak > bestStreak) {
                bestStreak = streak;
            }
        }
        else {
            streak = 0;
        }
    }
    return bestStreak;
}

//Display number of guesses for each win
function displayGuessDistribution() {
    let total = 0;
    let guessDistribution = {
        1: 0,
        2: 0,
        3: 0,
        4: 0,
        5: 0,
        6: 0,
        7: 0,
        8: 0,
    };

    //Tally number of guesses for each win
    gameData.forEach(game => {
        if (game.state === "win") {
            guessDistribution[game.guesses.length] += 1;
        }
    });

    //Set data value for display and calculate total wins 
    for (let i = 1; i <= 8; i++) {
        if (guessDistribution[i] !== 0) {
            barElems[i - 1].setAttribute("data-value", guessDistribution[i]);
            total += guessDistribution[i];
        }
    }

    //Set width of bar based on proportion of each guess number
    for (let i = 1; i <= 8; i++) {
        if (guessDistribution[i] !== 0) {
            barElems[i - 1].style.setProperty("--bar-width", `${Math.round((guessDistribution[i] / total) * 100)}%`);
        }
    }
}

//Display guessed ranger and info and save game state
function handleGuess(guessElem, ranger) {
    let correctCount = 0;
    let nameElem = guessElem.children[0];
    let colorElem = guessElem.children[1];
    let teamElem = guessElem.children[2];
    let eraElem = guessElem.children[3];

    nameElem.setAttribute("active", "true");
    let rangerName = ranger.name.split("(")[0];
    nameElem.textContent = rangerName
    correctCount += compareGuess(rangerName, target.name.split("(")[0], nameElem);

    colorElem.className = `guess__color ${ranger.color}-ranger`;
    correctCount += compareGuess(ranger.color, target.color, colorElem);

    teamElem.style.background = "black";
    teamElem.innerHTML = `<img src="img/${ranger.team}_logo.png" alt="${ranger.team}" Logo />`;
    correctCount += compareGuess(ranger.team, target.team, teamElem);

    eraElem.style.background = "white";
    eraElem.innerHTML = `<img src="img/${ranger.era}_logo.png" alt="${ranger.era}" Logo />`;
    correctCount += compareGuess(ranger.era, target.era, eraElem);

    guesses.push(ranger);
    if (correctCount === guessElem.children.length) {
        endGuessing("win");
    }
    else if (guesses.length == guessesElems.length) {
        endGuessing("loss");
    }
    saveGameData();
}

//Compare guess to target, set appropriate broder and convert to emoji
function compareGuess(guess, target, elem) {
    if (guess === target) {
        elem.style.borderColor = "green";
        guessesAsEmoji += "üü© "
        return 1;
    }
    else {
        elem.style.borderColor = "#b83030";
        guessesAsEmoji += "üü• ";
        return 0;
    }
}

function startGuessing() {
    formElem.style.display = "block";
    feedbackElem.style.display = "none";
    calculateStatistics();
    displayGuessDistribution();
}

function endGuessing(state) {
    formElem.style.display = "none";
    feedbackElem.style.display = "block";
    targetElem.innerHTML = target.name;
    targetElem.style.color = getComputedStyle(rootElem).getPropertyValue(`--${target.color}-ranger-clr`)
    gameState = state;
    displayGuessDistribution();
    shareButton.scrollIntoView();
}

//Autocomplete
function autocomplete(inp, arr) {
    /*the autocomplete function takes two arguments,
    the text field element and an array of possible autocompleted values:*/
    var currentFocus;
    /*execute a function when someone writes in the text field:*/
    inp.addEventListener("input", function (e) {
        var a, b, i, val = this.value;
        /*close any already open lists of autocompleted values*/
        closeAllLists();
        if (!val) { return false; }
        currentFocus = -1;
        /*create a DIV element that will contain the items (values):*/
        a = document.createElement("DIV");
        a.setAttribute("id", this.id + "autocomplete-list");
        a.setAttribute("class", "autocomplete-items");
        /*append the DIV element as a child of the autocomplete container:*/
        this.parentNode.appendChild(a);
        /*for each item in the array...*/
        for (i = 0; i < arr.length; i++) {
            /*check if the item starts with the same letters as the text field value:*/
            if (arr[i].name.substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                /*create a DIV element for each matching element:*/
                b = document.createElement("DIV");
                /*make the matching letters bold:*/
                b.innerHTML = "<strong>" + arr[i].name.substr(0, val.length) + "</strong>";
                b.innerHTML += arr[i].name.substr(val.length);
                /*insert a input field that will hold the current array item's value:*/
                b.innerHTML += "<input type='hidden' value='" + arr[i].name + "'>";
                /*execute a function when someone clicks on the item value (DIV element):*/
                b.addEventListener("click", function (e) {
                    /*insert the value for the autocomplete text field:*/
                    inp.value = this.getElementsByTagName("input")[0].value;
                    /*close the list of autocompleted values,
                    (or any other open lists of autocompleted values:*/
                    closeAllLists();
                });
                a.appendChild(b);
            }
        }
    });
    /*execute a function presses a key on the keyboard:*/
    inp.addEventListener("keydown", function (e) {
        var x = document.getElementById(this.id + "autocomplete-list");
        if (x) x = x.getElementsByTagName("div");
        if (e.keyCode == 40) {
            /*If the arrow DOWN key is pressed,
            increase the currentFocus variable:*/
            currentFocus++;
            /*and and make the current item more visible:*/
            addActive(x);
        } else if (e.keyCode == 38) { //up
            /*If the arrow UP key is pressed,
            decrease the currentFocus variable:*/
            currentFocus--;
            /*and and make the current item more visible:*/
            addActive(x);
        } else if (e.keyCode == 13) {
            /*If the ENTER key is pressed, prevent the form from being submitted,*/
            e.preventDefault();
            if (currentFocus > -1) {
                /*and simulate a click on the "active" item:*/
                if (x) x[currentFocus].click();
            }
        }
    });
    function addActive(x) {
        /*a function to classify an item as "active":*/
        if (!x) return false;
        /*start by removing the "active" class on all items:*/
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
        /*add class "autocomplete-active":*/
        x[currentFocus].classList.add("autocomplete-active");
    }
    function removeActive(x) {
        /*a function to remove the "active" class from all autocomplete items:*/
        for (var i = 0; i < x.length; i++) {
            x[i].classList.remove("autocomplete-active");
        }
    }
    function closeAllLists(elmnt) {
        /*close all autocomplete lists in the document,
        except the one passed as an argument:*/
        var x = document.getElementsByClassName("autocomplete-items");
        for (var i = 0; i < x.length; i++) {
            if (elmnt != x[i] && elmnt != inp) {
                x[i].parentNode.removeChild(x[i]);
            }
        }
    }
    /*execute a function when someone clicks in the document:*/
    document.addEventListener("click", function (e) {
        closeAllLists(e.target);
    });
}
autocomplete(inputElem, rangers);

//Countdown to UTC midnight (WIP)
setInterval(() => {
    let toDate = new Date();
    let tomorrow = new Date();
    tomorrow.setHours(24, 0, 0, 0);
    tomorrow.setHours(1, 0, 0, 0);
    let diffMS = tomorrow.getTime() / 1000 - toDate.getTime() / 1000;
    let diffHr = Math.floor(diffMS / 3600);
    diffMS = diffMS - diffHr * 3600;
    let diffMi = Math.floor(diffMS / 60);
    diffMS = diffMS - diffMi * 60;
    let diffS = Math.floor(diffMS);
    let result = ((diffHr < 10) ? "0" + diffHr : diffHr);
    result += ":" + ((diffMi < 10) ? "0" + diffMi : diffMi);
    result += ":" + ((diffS < 10) ? "0" + diffS : diffS);
    timeElem.innerHTML = result;

}, 1000);